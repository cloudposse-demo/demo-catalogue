# Build a service with environment variables
version: '1.0'

steps:
  build-image:
    type: build
    description: Build catalogue
    image-name: cloudpossedemo/catalogue
    dockerfile: Dockerfile
    tag: ${{CF_BRANCH}}

  push-image-branch:
    type: push
    candidate: ${{build-image}}
    tag: ${{CF_BRANCH}}

  push-image-commit:
    type: push
    candidate: ${{build-image}}
    tag: ${{CF_REVISION}}

  push-image-latest:
    type: push
    candidate: ${{build-image}}
    tag: latest
    when:
      condition:
        all:
          executeForMasterBranch: "'${{CF_BRANCH}}' == 'master'"